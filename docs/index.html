<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker Deck</title>
    <style>
        .clicked {
            background-color: grey;
            pointer-events: none; /* Disable further clicks */
        }
        .board {
            display: grid;
            grid-template-columns: repeat(5, 100px);
            grid-gap: 10px;
            margin-top: 20px;
        }
        .board-cell {
            width: 100px;
            height: 150px;
            border: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .row-clicked {
            background-color: #4CAF50;
            color: white;
        }
    </style>
    <script>
        let clickedButtons = 0;
        const totalButtons = 5;
        let boardIndex = 0;
        const totalBoardSlots = 15;

        function buttonClicked(button) {
            if (!button.classList.contains('clicked') && boardIndex < totalBoardSlots) {
                button.classList.add('clicked');
                addToBoard(button.innerText); // Add the card to the board
                clickedButtons += 1;
            }

            // When all 5 buttons are clicked, generate new cards
            if (clickedButtons === totalButtons && boardIndex < totalBoardSlots) {
                setTimeout(() => {
                    generateNewCards();
                }, 500); // Optional delay
            }

            // If the board is full, show game over and reset the game
            if (boardIndex === totalBoardSlots) {
                setTimeout(() => {
                    alert("Game over! Restarting...");
                    resetGame();
                }, 500);
            }
        }

        function addToBoard(card) {
            const boardCells = document.querySelectorAll('.board-cell');
            if (boardIndex < totalBoardSlots) {
                boardCells[boardIndex].innerText = card;  // Place the card in the next available spot
                boardIndex += 1;
            }
        }

        function generateNewCards() {
            fetch('/get-cards')
                .then(response => response.json())
                .then(data => {
                    const buttons = document.querySelectorAll('.button');

                    buttons.forEach((button, index) => {
                        if (data.cards && data.cards[index]) {
                            button.innerText = data.cards[index];
                            button.classList.remove('clicked');  // Reset button state
                        }
                    });

                    clickedButtons = 0;

                    // If no more cards are left, disable buttons and show a message
                    if (data.message) {
                        document.getElementById('card-display').innerText = data.message;
                        buttons.forEach(button => button.classList.add('clicked'));
                    }

                    document.getElementById('cards-left').innerText = 'Cards left: ' + data.cards_left;
                });
        }

        function resetGame() {
            // Reset the deck and the board
            fetch('/get-cards')
                .then(() => {
                    // Clear the board
                    const boardCells = document.querySelectorAll('.board-cell');
                    boardCells.forEach(cell => cell.innerText = "");

                    boardIndex = 0;
                    clickedButtons = 0;

                    // Generate new cards for the buttons
                    generateNewCards();
                });
        }
        function handleRowButtonClick(event) {
            const rowButtons = document.querySelectorAll('.row-button');
            rowButtons.forEach(button => button.classList.remove('row-clicked')); // Deselect all
            event.target.classList.add('row-clicked'); // Select the clicked button

            // Display which row is clicked
            const rowName = event.target.innerText;
            alert(`Currently clicked row: ${rowName}`);
        }

        // Call to generate the first set of cards when the page loads
        window.onload = generateNewCards;
    </script>
</head>
<body>
    <h1>Poker Deck</h1>
    <div>
        <button id="button-1" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-2" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-3" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-4" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-5" class="button" onclick="buttonClicked(this)">Loading...</button>
    </div>
    <div id="card-display"></div>
    <div id="cards-left"></div>

    <!-- Board to place the cards -->
    <div class="board">
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
    </div>

    <!-- Row buttons -->
    <div id="row-buttons" style="margin-top: 20px;">
        <button class="row-button" onclick="handleRowButtonClick(event)">Top Row</button>
        <button class="row-button" onclick="handleRowButtonClick(event)">Middle Row</button>
        <button class="row-button" onclick="handleRowButtonClick(event)">Bottom Row</button>
    </div>
</body>
</html>
