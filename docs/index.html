<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Poker Deck</title>
    <style>
        .clicked {
            background-color: grey;
            pointer-events: none; /* Disable further clicks */
        }
        .board {
            display: grid;
            grid-template-columns: repeat(5, 100px);
            grid-gap: 10px;
            margin-top: 20px;
        }
        .board-cell {
            width: 100px;
            height: 150px;
            border: 1px solid black;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .dummy-cell {
            visibility: hidden; /* Dummy cells will be hidden */
        }
        .row-clicked {
            background-color: #4CAF50;
            color: white;
        }
    </style>
    <script>
        let clickedButtons = 0;
        const totalButtons = 5;
        let boardIndex = 0;
        const totalBoardSlots = 13;

        let selectedRow = 'top'; // Default row is 'top'

        function buttonClicked(button) {
            if (!button.classList.contains('clicked') && boardIndex < totalBoardSlots) {
                button.classList.add('clicked');
                addToBoard(button.innerText); // Add the card to the correct row
                clickedButtons += 1;
            }

            // When all 5 buttons are clicked, generate new cards
            if (clickedButtons === totalButtons && boardIndex < totalBoardSlots) {
                setTimeout(() => {
                    generateNewCards();
                }, 500); // Optional delay
            }

            // If the board is full, show game over and reset the game
            if (boardIndex === totalBoardSlots) {
                setTimeout(() => {
                    alert("Game over! Restarting...");
                    resetGame();
                }, 500);
            }
        }

        function addToBoard(card) {
            let boardCells;
            // Select the row based on the current selection
            switch (selectedRow) {
                case 'top':
                    boardCells = document.querySelectorAll('.board-cell:nth-child(-n+5)'); // Top row (first 5 cells)
                    break;
                case 'middle':
                    boardCells = document.querySelectorAll('.board-cell:nth-child(n+6):nth-child(-n+10)'); // Middle row (next 5 cells)
                    break;
                case 'bottom':
                    boardCells = document.querySelectorAll('.board-cell:nth-child(n+11):nth-child(-n+15)'); // Bottom row (last 5 cells)
                    break;
            }

            boardIndex += 1;

            // Find the next available spot in the selected row
            for (let cell of boardCells) {
                if (!cell.innerText) {
                    cell.innerText = card;
                    break;
                }
            }
        }

        function generateNewCards() {
            fetch('/get-cards')
                .then(response => response.json())
                .then(data => {
                    const buttons = document.querySelectorAll('.button');

                    buttons.forEach((button, index) => {
                        if (data.cards && data.cards[index]) {
                            button.innerText = data.cards[index];
                            button.classList.remove('clicked');  // Reset button state
                        }
                    });

                    clickedButtons = 0;

                    // If no more cards are left, disable buttons and show a message
                    if (data.message) {
                        document.getElementById('card-display').innerText = data.message;
                        buttons.forEach(button => button.classList.add('clicked'));
                    }

                    document.getElementById('cards-left').innerText = 'Cards left: ' + data.cards_left;
                });
        }

        function resetGame() {
            // Reset the deck and the board
            fetch('/initialize_deck')
            fetch('/get-cards')
                .then(() => {
                    // Clear the board
                    const boardCells = document.querySelectorAll('.board-cell');
                    boardCells.forEach(cell => cell.innerText = "");

                    boardIndex = 0;
                    clickedButtons = 0;

                    // Generate new cards for the buttons
                    generateNewCards();
                });
        }

        // Handle row button clicks and ensure only one button is clicked at a time
        function handleRowButtonClick(event) {
            const rowButtons = document.querySelectorAll('.row-button');
            rowButtons.forEach(button => button.classList.remove('row-clicked')); // Deselect all
            event.target.classList.add('row-clicked'); // Select the clicked button

            // Set the currently selected row based on button click
            selectedRow = event.target.getAttribute('data-row');
        }

        // Call to generate the first set of cards and select default row when the page loads
        window.onload = () => {
            generateNewCards();
            document.querySelector('[data-row="top"]').classList.add('row-clicked'); // Default to top row
        }
    </script>
</head>
<body>
    <h1>Poker Deck</h1>
    <div>
        <button id="button-1" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-2" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-3" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-4" class="button" onclick="buttonClicked(this)">Loading...</button>
        <button id="button-5" class="button" onclick="buttonClicked(this)">Loading...</button>
    </div>
    <div id="card-display"></div>
    <div id="cards-left"></div>

    <!-- Board to place the cards -->
    <div class="board">
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell dummy-cell"></div> <!-- Dummy cell -->
        <div class="board-cell dummy-cell"></div> <!-- Dummy cell -->
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
        <div class="board-cell"></div>
    </div>

    <!-- Row buttons -->
    <div id="row-buttons" style="margin-top: 20px;">
        <button class="row-button" data-row="top" onclick="handleRowButtonClick(event)">Top Row</button>
        <button class="row-button" data-row="middle" onclick="handleRowButtonClick(event)">Middle Row</button>
        <button class="row-button" data-row="bottom" onclick="handleRowButtonClick(event)">Bottom Row</button>
    </div>
</body>
</html>
